{"remainingRequest":"/Users/janzheng/Desktop/projects/_lessons/feathersjs/feathers-chat-vuex/node_modules/babel-loader/lib/index.js!/Users/janzheng/Desktop/projects/_lessons/feathersjs/feathers-chat-vuex/node_modules/feathers-vuex/dist/utils.js","dependencies":[{"path":"/Users/janzheng/Desktop/projects/_lessons/feathersjs/feathers-chat-vuex/node_modules/feathers-vuex/dist/utils.js","mtime":1576553531990},{"path":"/Users/janzheng/Desktop/projects/_lessons/feathersjs/feathers-chat-vuex/node_modules/cache-loader/dist/cjs.js","mtime":1576617922850},{"path":"/Users/janzheng/Desktop/projects/_lessons/feathersjs/feathers-chat-vuex/node_modules/babel-loader/lib/index.js","mtime":1572970632149}],"contextDependencies":[],"result":["import \"core-js/modules/es6.array.find\";\nimport \"core-js/modules/es6.function.name\";\nimport \"core-js/modules/es6.object.keys\";\nimport \"core-js/modules/web.dom.iterable\";\nimport \"core-js/modules/es6.regexp.replace\";\nimport \"core-js/modules/es6.regexp.to-string\";\nimport \"core-js/modules/es7.array.includes\";\nimport \"core-js/modules/es6.string.includes\";\nimport _typeof from \"/Users/janzheng/Desktop/projects/_lessons/feathersjs/feathers-chat-vuex/node_modules/@babel/runtime-corejs2/helpers/esm/typeof\";\nimport \"core-js/modules/es6.regexp.split\";\n\n/*\neslint\n@typescript-eslint/explicit-function-return-type: 0,\n@typescript-eslint/no-explicit-any: 0\n*/\nimport decode from 'jwt-decode';\nimport inflection from 'inflection';\nimport Vue from 'vue';\nimport fastCopy from 'fast-copy';\nimport _isObject from 'lodash/isObject';\nimport _trim from 'lodash/trim';\nimport _omit from 'lodash/omit';\nimport ObjectID from 'bson-objectid';\nimport { globalModels as models } from \"./service-module/global-models\";\nimport stringify from 'fast-json-stable-stringify';\nexport function stripSlashes(location) {\n  return _trim(location, '/');\n}\nexport function setByDot(obj, path, value, ifDelete) {\n  if (ifDelete) {\n    // eslint-disable-next-line no-console\n    console.log('DEPRECATED. Use deleteByDot instead of setByDot(obj,path,value,true). (setByDot)');\n  }\n\n  if (path.indexOf('.') === -1) {\n    obj[path] = value;\n\n    if (value === undefined && ifDelete) {\n      delete obj[path];\n    }\n\n    return;\n  }\n\n  var parts = path.split('.');\n  var lastIndex = parts.length - 1;\n  return parts.reduce(function (obj1, part, i) {\n    if (i !== lastIndex) {\n      if (!obj1.hasOwnProperty(part) || _typeof(obj1[part]) !== 'object') {\n        obj1[part] = {};\n      }\n\n      return obj1[part];\n    }\n\n    obj1[part] = value;\n\n    if (value === undefined && ifDelete) {\n      delete obj1[part];\n    }\n\n    return obj1;\n  }, obj);\n}\nexport function upperCaseFirst(string) {\n  return string.charAt(0).toUpperCase() + string.slice(1);\n}\nexport function getShortName(service) {\n  var namespace = stripSlashes(service);\n\n  if (Array.isArray(namespace)) {\n    namespace = namespace.slice(-1);\n  } else if (namespace.includes('/')) {\n    namespace = namespace.slice(namespace.lastIndexOf('/') + 1);\n  }\n\n  return namespace;\n}\nexport function getNameFromPath(service) {\n  return stripSlashes(service);\n} // Reads and returns the contents of a cookie with the provided name.\n\nexport function readCookie(cookies, name) {\n  if (!cookies) {\n    return undefined;\n  }\n\n  var nameEQ = name + '=';\n  var ca = cookies.split(';');\n\n  for (var i = 0; i < ca.length; i++) {\n    var c = ca[i];\n\n    while (c.charAt(0) === ' ') {\n      c = c.substring(1, c.length);\n    }\n\n    if (c.indexOf(nameEQ) === 0) {\n      return c.substring(nameEQ.length, c.length);\n    }\n  }\n\n  return null;\n} // Pass a decoded payload and it will return a boolean based on if it hasn't expired.\n\nexport function payloadIsValid(payload) {\n  return payload && payload.exp * 1000 > new Date().getTime();\n} // from https://github.com/iliakan/detect-node\n\nexport var isNode = Object.prototype.toString.call(typeof process !== 'undefined' ? process : 0) === '[object process]';\nexport var isBrowser = !isNode;\nvar authDefaults = {\n  commit: undefined,\n  req: undefined,\n  moduleName: 'auth',\n  cookieName: 'feathers-jwt'\n};\nexport function getValidPayloadFromToken(token) {\n  if (token) {\n    try {\n      var payload = decode(token);\n      return payloadIsValid(payload) ? payload : undefined;\n    } catch (error) {\n      return undefined;\n    }\n  }\n\n  return undefined;\n}\nexport var initAuth = function initAuth(options) {\n  var _Object$assign = Object.assign({}, authDefaults, options),\n      commit = _Object$assign.commit,\n      req = _Object$assign.req,\n      moduleName = _Object$assign.moduleName,\n      cookieName = _Object$assign.cookieName,\n      feathersClient = _Object$assign.feathersClient;\n\n  if (typeof commit !== 'function') {\n    throw new Error('You must pass the `commit` function in the `initAuth` function options.');\n  }\n\n  if (!req) {\n    throw new Error('You must pass the `req` object in the `initAuth` function options.');\n  }\n\n  var accessToken = readCookie(req.headers.cookie, cookieName);\n  var payload = getValidPayloadFromToken(accessToken);\n\n  if (payload) {\n    commit(\"\".concat(moduleName, \"/setAccessToken\"), accessToken);\n    commit(\"\".concat(moduleName, \"/setPayload\"), payload);\n\n    if (feathersClient) {\n      return feathersClient.authentication.setAccessToken(accessToken).then(function () {\n        return payload;\n      });\n    }\n  }\n\n  return Promise.resolve(payload);\n};\n/**\n * Generate a new tempId and mark the record as a temp\n * @param state\n * @param item\n */\n\nexport function assignTempId(state, item) {\n  var debug = state.debug,\n      tempIdField = state.tempIdField;\n\n  if (debug) {\n    // eslint-disable-next-line no-console\n    console.info('assigning temporary id to item', item);\n  }\n\n  var newId = new ObjectID().toHexString();\n  item[tempIdField] = newId;\n  return newId;\n}\n/**\n * Get the id from a record in this order:\n *   1. id\n *   2. _id\n *   3. the `idField`\n * @param item\n */\n\nexport function getId(item, idField) {\n  if (!item) {\n    return;\n  }\n\n  if (item.id != null || item.hasOwnProperty('id')) {\n    return item.id;\n  }\n\n  if (item._id != null || item.hasOwnProperty('_id')) {\n    return item._id;\n  }\n\n  if (item[idField] != null || item.hasOwnProperty(idField)) {\n    return item[idField];\n  }\n} // Creates a Model class name from the last part of the servicePath\n\nexport function getModelName(Model) {\n  // If the Model.name has been customized, use it.\n  if (Model.modelName) {\n    return Model.modelName;\n  } // Otherwise, use an inflection of the last bit of the servicePath\n\n\n  var parts = Model.servicePath.split('/');\n  var name = parts[parts.length - 1];\n  name = inflection.titleize(name);\n  name = name.split('-').join('');\n  name = inflection.singularize(name);\n  return name;\n}\nexport function registerModel(Model, globalModels, apiPrefix, servicePath) {\n  var modelName = getModelName(Model);\n  var path = apiPrefix ? \"\".concat(apiPrefix, \".\").concat(modelName) : modelName;\n  setByDot(globalModels, path, Model);\n  globalModels.byServicePath[servicePath] = Model;\n  return {\n    path: path,\n    name: modelName\n  };\n}\nexport function getServicePrefix(servicePath) {\n  var parts = servicePath.split('/');\n  var name = parts[parts.length - 1]; // name = inflection.underscore(name)\n\n  name = name.replace('-', '_');\n  name = inflection.camelize(name, true);\n  return name;\n}\nexport function getServiceCapitalization(servicePath) {\n  var parts = servicePath.split('/');\n  var name = parts[parts.length - 1]; // name = inflection.underscore(name)\n\n  name = name.replace('-', '_');\n  name = inflection.camelize(name);\n  return name;\n}\nexport function updateOriginal(original, newData) {\n  Object.keys(newData).forEach(function (key) {\n    var newProp = newData[key];\n    var oldProp = original[key];\n    var shouldCopyProp = false;\n\n    if (newProp === oldProp) {\n      return;\n    } // If the old item doesn't already have this property, update it\n\n\n    if (!original.hasOwnProperty(key)) {\n      shouldCopyProp = true; // If the old prop is null or undefined, and the new prop is neither\n    } else if ((oldProp === null || oldProp === undefined) && newProp !== null && newProp !== undefined) {\n      shouldCopyProp = true; // If both old and new are arrays\n    } else if (Array.isArray(oldProp) && Array.isArray(newProp)) {\n      shouldCopyProp = true;\n    } else if (_isObject(oldProp)) {\n      shouldCopyProp = true;\n    } else if (oldProp !== newProp && !Array.isArray(oldProp) && !Array.isArray(newProp)) {\n      shouldCopyProp = true;\n    }\n\n    if (shouldCopyProp) {\n      if (original.hasOwnProperty(key)) {\n        original[key] = newProp;\n      } else {\n        Vue.set(original, key, newProp);\n      }\n    }\n  });\n}\nexport function getQueryInfo() {\n  var params = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n  var response = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  var query = params.query || {};\n  var qid = params.qid || 'default';\n  var $limit = response.limit !== null && response.limit !== undefined ? response.limit : query.$limit;\n  var $skip = response.skip !== null && response.skip !== undefined ? response.skip : query.$skip;\n\n  var queryParams = _omit(query, ['$limit', '$skip']);\n\n  var queryId = stringify(queryParams);\n  var pageParams = $limit !== undefined ? {\n    $limit: $limit,\n    $skip: $skip\n  } : undefined;\n  var pageId = pageParams ? stringify(pageParams) : undefined;\n  return {\n    qid: qid,\n    query: query,\n    queryId: queryId,\n    queryParams: queryParams,\n    pageParams: pageParams,\n    pageId: pageId,\n    response: undefined,\n    isOutdated: undefined\n  };\n}\nexport function getItemsFromQueryInfo(pagination, queryInfo, keyedById) {\n  var queryId = queryInfo.queryId,\n      pageId = queryInfo.pageId;\n  var queryLevel = pagination[queryId];\n  var pageLevel = queryLevel && queryLevel[pageId];\n  var ids = pageLevel && pageLevel.ids;\n\n  if (ids && ids.length) {\n    return ids.map(function (id) {\n      return keyedById[id];\n    });\n  } else {\n    return [];\n  }\n}\nexport function makeNamespace(namespace, servicePath, nameStyle) {\n  var nameStyles = {\n    short: getShortName,\n    path: getNameFromPath\n  };\n  return namespace || nameStyles[nameStyle](servicePath);\n}\n/**\n * Gets the service path or name from the service.  The modelname is provided\n * to allow easier discovery if there's a problem.\n * @param service\n * @param modelName\n */\n\nexport function getServicePath(service, Model) {\n  if (!service.name && !service.path && !Model.servicePath) {\n    throw new Error(\"Service for model named \".concat(Model.name, \" is missing a path or name property. The feathers adapter needs to be updated with a PR to expose this property. You can work around this by adding a static servicePath =  passing a 'servicePath' attribute in the options: makeServicePlugin({servicePath: '/path/to/my/service'})\"));\n  }\n\n  return service.path || service.name || Model.servicePath;\n}\nexport function randomString(length) {\n  var text = '';\n  var possible = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\n\n  for (var i = 0; i < length; i++) {\n    text += possible.charAt(Math.floor(Math.random() * possible.length));\n  }\n\n  return text;\n}\nexport function createRelatedInstance(_ref) {\n  var item = _ref.item,\n      Model = _ref.Model,\n      idField = _ref.idField,\n      store = _ref.store;\n  // Create store instances (if data contains an idField)\n  var model = new Model(item);\n  var id = getId(model, idField);\n  var storedModel = store.state[model.constructor.namespace].keyedById[id];\n  return {\n    model: model,\n    storedModel: storedModel\n  };\n}\nexport function isBaseModelInstance(item) {\n  var baseModels = Object.keys(models).map(function (alias) {\n    return models[alias].BaseModel;\n  });\n  return !!baseModels.find(function (BaseModel) {\n    return item instanceof BaseModel;\n  });\n}\nexport function mergeWithAccessors(dest, source) {\n  var blacklist = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : ['__isClone', '__ob__'];\n  var sourceProps = Object.getOwnPropertyNames(source);\n  var destProps = Object.getOwnPropertyNames(dest);\n  var sourceIsVueObservable = sourceProps.includes('__ob__');\n  var destIsVueObservable = destProps.includes('__ob__');\n  sourceProps.forEach(function (key) {\n    var sourceDesc = Object.getOwnPropertyDescriptor(source, key);\n    var destDesc = Object.getOwnPropertyDescriptor(dest, key); // if (Array.isArray(source[key]) && source[key].find(i => i.__ob__)) {\n    //   sourceIsVueObservable = true\n    // }\n    // if (Array.isArray(dest[key]) && dest[key].find(i => i.__ob__)) {\n    //   destIsVueObservable = true\n    // }\n    // This might have to be uncommented, but we'll try it this way, for now.\n    // if (!sourceDesc.enumerable) {\n    //   return\n    // }\n    // If the destination is not writable, return. Also ignore blacklisted keys.\n    // Must explicitly check if writable is false\n\n    if (destDesc && destDesc.writable === false || blacklist.includes(key)) {\n      return;\n    } // Handle Vue observable objects\n\n\n    if (destIsVueObservable || sourceIsVueObservable) {\n      var isObject = _isObject(source[key]);\n\n      var isFeathersVuexInstance = isObject && !!(source[key].constructor.modelName || source[key].constructor.namespace); // Do not use fastCopy directly on a feathers-vuex BaseModel instance to keep from breaking reactivity.\n\n      if (isObject && !isFeathersVuexInstance) {\n        try {\n          var sourceObject = source[key];\n          dest[key] = fastCopy(source[key]);\n        } catch (err) {\n          if (!err.message.includes('getter')) {\n            throw err;\n          }\n        }\n      } else {\n        try {\n          dest[key] = source[key];\n        } catch (err) {\n          if (!err.message.includes('getter')) {\n            throw err;\n          }\n        }\n      }\n\n      return;\n    } // Handle defining accessors\n\n\n    if (typeof sourceDesc.get === 'function' || typeof sourceDesc.set === 'function') {\n      Object.defineProperty(dest, key, sourceDesc);\n      return;\n    } // Do not attempt to overwrite a getter in the dest object\n\n\n    if (destDesc && typeof destDesc.get === 'function') {\n      return;\n    } // Assign values\n    // Do not allow sharing of deeply-nested objects between instances\n    // Potentially breaks accessors on nested data. Needs recursion if this is an issue\n\n\n    if (_isObject(sourceDesc.value) && !isBaseModelInstance(sourceDesc.value)) {\n      var value = fastCopy(sourceDesc.value);\n    }\n\n    dest[key] = value || sourceDesc.value;\n  });\n  return dest;\n}\nexport function checkNamespace(namespace, item, debug) {\n  if (!namespace && debug) {\n    // eslint-disable-next-line no-console\n    console.error('A `namespace` was not available on the Model for this item:', item, 'this can be caused by not passing the Model into the makeServicePlugin function');\n  }\n\n  return namespace !== null && namespace !== undefined;\n}\nexport function assignIfNotPresent(Model, props) {\n  for (var key in props) {\n    if (!Model.hasOwnProperty(key)) {\n      Model[key] = props[key];\n    }\n  }\n}",{"version":3,"sources":["/Users/janzheng/Desktop/projects/_lessons/feathersjs/feathers-chat-vuex/node_modules/feathers-vuex/dist/utils.js"],"names":["decode","inflection","Vue","fastCopy","_isObject","_trim","_omit","ObjectID","globalModels","models","stringify","stripSlashes","location","setByDot","obj","path","value","ifDelete","console","log","indexOf","undefined","parts","split","lastIndex","length","reduce","obj1","part","i","hasOwnProperty","upperCaseFirst","string","charAt","toUpperCase","slice","getShortName","service","namespace","Array","isArray","includes","lastIndexOf","getNameFromPath","readCookie","cookies","name","nameEQ","ca","c","substring","payloadIsValid","payload","exp","Date","getTime","isNode","Object","prototype","toString","call","process","isBrowser","authDefaults","commit","req","moduleName","cookieName","getValidPayloadFromToken","token","error","initAuth","options","assign","feathersClient","Error","accessToken","headers","cookie","authentication","setAccessToken","then","Promise","resolve","assignTempId","state","item","debug","tempIdField","info","newId","toHexString","getId","idField","id","_id","getModelName","Model","modelName","servicePath","titleize","join","singularize","registerModel","apiPrefix","byServicePath","getServicePrefix","replace","camelize","getServiceCapitalization","updateOriginal","original","newData","keys","forEach","key","newProp","oldProp","shouldCopyProp","set","getQueryInfo","params","response","query","qid","$limit","limit","$skip","skip","queryParams","queryId","pageParams","pageId","isOutdated","getItemsFromQueryInfo","pagination","queryInfo","keyedById","queryLevel","pageLevel","ids","map","makeNamespace","nameStyle","nameStyles","short","getServicePath","randomString","text","possible","Math","floor","random","createRelatedInstance","store","model","storedModel","constructor","isBaseModelInstance","baseModels","alias","BaseModel","find","mergeWithAccessors","dest","source","blacklist","sourceProps","getOwnPropertyNames","destProps","sourceIsVueObservable","destIsVueObservable","sourceDesc","getOwnPropertyDescriptor","destDesc","writable","isObject","isFeathersVuexInstance","sourceObject","err","message","get","defineProperty","checkNamespace","assignIfNotPresent","props"],"mappings":"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","sourcesContent":["/*\neslint\n@typescript-eslint/explicit-function-return-type: 0,\n@typescript-eslint/no-explicit-any: 0\n*/\nimport decode from 'jwt-decode'\nimport inflection from 'inflection'\nimport Vue from 'vue'\nimport fastCopy from 'fast-copy'\nimport _isObject from 'lodash/isObject'\nimport _trim from 'lodash/trim'\nimport _omit from 'lodash/omit'\nimport ObjectID from 'bson-objectid'\nimport { globalModels as models } from './service-module/global-models'\nimport stringify from 'fast-json-stable-stringify'\nexport function stripSlashes(location) {\n  return _trim(location, '/')\n}\nexport function setByDot(obj, path, value, ifDelete) {\n  if (ifDelete) {\n    // eslint-disable-next-line no-console\n    console.log(\n      'DEPRECATED. Use deleteByDot instead of setByDot(obj,path,value,true). (setByDot)'\n    )\n  }\n  if (path.indexOf('.') === -1) {\n    obj[path] = value\n    if (value === undefined && ifDelete) {\n      delete obj[path]\n    }\n    return\n  }\n  const parts = path.split('.')\n  const lastIndex = parts.length - 1\n  return parts.reduce((obj1, part, i) => {\n    if (i !== lastIndex) {\n      if (!obj1.hasOwnProperty(part) || typeof obj1[part] !== 'object') {\n        obj1[part] = {}\n      }\n      return obj1[part]\n    }\n    obj1[part] = value\n    if (value === undefined && ifDelete) {\n      delete obj1[part]\n    }\n    return obj1\n  }, obj)\n}\nexport function upperCaseFirst(string) {\n  return string.charAt(0).toUpperCase() + string.slice(1)\n}\nexport function getShortName(service) {\n  let namespace = stripSlashes(service)\n  if (Array.isArray(namespace)) {\n    namespace = namespace.slice(-1)\n  } else if (namespace.includes('/')) {\n    namespace = namespace.slice(namespace.lastIndexOf('/') + 1)\n  }\n  return namespace\n}\nexport function getNameFromPath(service) {\n  return stripSlashes(service)\n}\n// Reads and returns the contents of a cookie with the provided name.\nexport function readCookie(cookies, name) {\n  if (!cookies) {\n    return undefined\n  }\n  var nameEQ = name + '='\n  var ca = cookies.split(';')\n  for (var i = 0; i < ca.length; i++) {\n    var c = ca[i]\n    while (c.charAt(0) === ' ') {\n      c = c.substring(1, c.length)\n    }\n    if (c.indexOf(nameEQ) === 0) {\n      return c.substring(nameEQ.length, c.length)\n    }\n  }\n  return null\n}\n// Pass a decoded payload and it will return a boolean based on if it hasn't expired.\nexport function payloadIsValid(payload) {\n  return payload && payload.exp * 1000 > new Date().getTime()\n}\n// from https://github.com/iliakan/detect-node\nexport const isNode =\n  Object.prototype.toString.call(\n    typeof process !== 'undefined' ? process : 0\n  ) === '[object process]'\nexport const isBrowser = !isNode\nconst authDefaults = {\n  commit: undefined,\n  req: undefined,\n  moduleName: 'auth',\n  cookieName: 'feathers-jwt'\n}\nexport function getValidPayloadFromToken(token) {\n  if (token) {\n    try {\n      var payload = decode(token)\n      return payloadIsValid(payload) ? payload : undefined\n    } catch (error) {\n      return undefined\n    }\n  }\n  return undefined\n}\nexport const initAuth = function initAuth(options) {\n  const { commit, req, moduleName, cookieName, feathersClient } = Object.assign(\n    {},\n    authDefaults,\n    options\n  )\n  if (typeof commit !== 'function') {\n    throw new Error(\n      'You must pass the `commit` function in the `initAuth` function options.'\n    )\n  }\n  if (!req) {\n    throw new Error(\n      'You must pass the `req` object in the `initAuth` function options.'\n    )\n  }\n  const accessToken = readCookie(req.headers.cookie, cookieName)\n  const payload = getValidPayloadFromToken(accessToken)\n  if (payload) {\n    commit(`${moduleName}/setAccessToken`, accessToken)\n    commit(`${moduleName}/setPayload`, payload)\n    if (feathersClient) {\n      return feathersClient.authentication\n        .setAccessToken(accessToken)\n        .then(() => payload)\n    }\n  }\n  return Promise.resolve(payload)\n}\n/**\n * Generate a new tempId and mark the record as a temp\n * @param state\n * @param item\n */\nexport function assignTempId(state, item) {\n  const { debug, tempIdField } = state\n  if (debug) {\n    // eslint-disable-next-line no-console\n    console.info('assigning temporary id to item', item)\n  }\n  const newId = new ObjectID().toHexString()\n  item[tempIdField] = newId\n  return newId\n}\n/**\n * Get the id from a record in this order:\n *   1. id\n *   2. _id\n *   3. the `idField`\n * @param item\n */\nexport function getId(item, idField) {\n  if (!item) {\n    return\n  }\n  if (item.id != null || item.hasOwnProperty('id')) {\n    return item.id\n  }\n  if (item._id != null || item.hasOwnProperty('_id')) {\n    return item._id\n  }\n  if (item[idField] != null || item.hasOwnProperty(idField)) {\n    return item[idField]\n  }\n}\n// Creates a Model class name from the last part of the servicePath\nexport function getModelName(Model) {\n  // If the Model.name has been customized, use it.\n  if (Model.modelName) {\n    return Model.modelName\n  }\n  // Otherwise, use an inflection of the last bit of the servicePath\n  const parts = Model.servicePath.split('/')\n  let name = parts[parts.length - 1]\n  name = inflection.titleize(name)\n  name = name.split('-').join('')\n  name = inflection.singularize(name)\n  return name\n}\nexport function registerModel(Model, globalModels, apiPrefix, servicePath) {\n  const modelName = getModelName(Model)\n  let path = apiPrefix ? `${apiPrefix}.${modelName}` : modelName\n  setByDot(globalModels, path, Model)\n  globalModels.byServicePath[servicePath] = Model\n  return {\n    path,\n    name: modelName\n  }\n}\nexport function getServicePrefix(servicePath) {\n  const parts = servicePath.split('/')\n  let name = parts[parts.length - 1]\n  // name = inflection.underscore(name)\n  name = name.replace('-', '_')\n  name = inflection.camelize(name, true)\n  return name\n}\nexport function getServiceCapitalization(servicePath) {\n  const parts = servicePath.split('/')\n  let name = parts[parts.length - 1]\n  // name = inflection.underscore(name)\n  name = name.replace('-', '_')\n  name = inflection.camelize(name)\n  return name\n}\nexport function updateOriginal(original, newData) {\n  Object.keys(newData).forEach(key => {\n    const newProp = newData[key]\n    const oldProp = original[key]\n    let shouldCopyProp = false\n    if (newProp === oldProp) {\n      return\n    }\n    // If the old item doesn't already have this property, update it\n    if (!original.hasOwnProperty(key)) {\n      shouldCopyProp = true\n      // If the old prop is null or undefined, and the new prop is neither\n    } else if (\n      (oldProp === null || oldProp === undefined) &&\n      newProp !== null && newProp !== undefined\n    ) {\n      shouldCopyProp = true\n      // If both old and new are arrays\n    } else if (Array.isArray(oldProp) && Array.isArray(newProp)) {\n      shouldCopyProp = true\n    } else if (_isObject(oldProp)) {\n      shouldCopyProp = true\n    } else if (\n      oldProp !== newProp &&\n      !Array.isArray(oldProp) &&\n      !Array.isArray(newProp)\n    ) {\n      shouldCopyProp = true\n    }\n    if (shouldCopyProp) {\n      if (original.hasOwnProperty(key)) {\n        original[key] = newProp\n      } else {\n        Vue.set(original, key, newProp)\n      }\n    }\n  })\n}\nexport function getQueryInfo(params = {}, response = {}) {\n  const query = params.query || {}\n  const qid = params.qid || 'default'\n  const $limit =\n    response.limit !== null && response.limit !== undefined\n      ? response.limit\n      : query.$limit\n  const $skip =\n    response.skip !== null && response.skip !== undefined\n      ? response.skip\n      : query.$skip\n  const queryParams = _omit(query, ['$limit', '$skip'])\n  const queryId = stringify(queryParams)\n  const pageParams = $limit !== undefined ? { $limit, $skip } : undefined\n  const pageId = pageParams ? stringify(pageParams) : undefined\n  return {\n    qid,\n    query,\n    queryId,\n    queryParams,\n    pageParams,\n    pageId,\n    response: undefined,\n    isOutdated: undefined\n  }\n}\nexport function getItemsFromQueryInfo(pagination, queryInfo, keyedById) {\n  const { queryId, pageId } = queryInfo\n  const queryLevel = pagination[queryId]\n  const pageLevel = queryLevel && queryLevel[pageId]\n  const ids = pageLevel && pageLevel.ids\n  if (ids && ids.length) {\n    return ids.map(id => keyedById[id])\n  } else {\n    return []\n  }\n}\nexport function makeNamespace(namespace, servicePath, nameStyle) {\n  const nameStyles = {\n    short: getShortName,\n    path: getNameFromPath\n  }\n  return namespace || nameStyles[nameStyle](servicePath)\n}\n/**\n * Gets the service path or name from the service.  The modelname is provided\n * to allow easier discovery if there's a problem.\n * @param service\n * @param modelName\n */\nexport function getServicePath(service, Model) {\n  if (!service.name && !service.path && !Model.servicePath) {\n    throw new Error(\n      `Service for model named ${Model.name} is missing a path or name property. The feathers adapter needs to be updated with a PR to expose this property. You can work around this by adding a static servicePath =  passing a 'servicePath' attribute in the options: makeServicePlugin({servicePath: '/path/to/my/service'})`\n    )\n  }\n  return service.path || service.name || Model.servicePath\n}\nexport function randomString(length) {\n  let text = ''\n  let possible =\n    'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789'\n  for (let i = 0; i < length; i++) {\n    text += possible.charAt(Math.floor(Math.random() * possible.length))\n  }\n  return text\n}\nexport function createRelatedInstance({ item, Model, idField, store }) {\n  // Create store instances (if data contains an idField)\n  const model = new Model(item)\n  const id = getId(model, idField)\n  const storedModel = store.state[model.constructor.namespace].keyedById[id]\n  return { model, storedModel }\n}\nexport function isBaseModelInstance(item) {\n  const baseModels = Object.keys(models).map(alias => models[alias].BaseModel)\n  return !!baseModels.find(BaseModel => {\n    return item instanceof BaseModel\n  })\n}\nexport function mergeWithAccessors(\n  dest,\n  source,\n  blacklist = ['__isClone', '__ob__']\n) {\n  const sourceProps = Object.getOwnPropertyNames(source)\n  const destProps = Object.getOwnPropertyNames(dest)\n  let sourceIsVueObservable = sourceProps.includes('__ob__')\n  let destIsVueObservable = destProps.includes('__ob__')\n  sourceProps.forEach(key => {\n    const sourceDesc = Object.getOwnPropertyDescriptor(source, key)\n    const destDesc = Object.getOwnPropertyDescriptor(dest, key)\n    // if (Array.isArray(source[key]) && source[key].find(i => i.__ob__)) {\n    //   sourceIsVueObservable = true\n    // }\n    // if (Array.isArray(dest[key]) && dest[key].find(i => i.__ob__)) {\n    //   destIsVueObservable = true\n    // }\n    // This might have to be uncommented, but we'll try it this way, for now.\n    // if (!sourceDesc.enumerable) {\n    //   return\n    // }\n    // If the destination is not writable, return. Also ignore blacklisted keys.\n    // Must explicitly check if writable is false\n    if ((destDesc && destDesc.writable === false) || blacklist.includes(key)) {\n      return\n    }\n    // Handle Vue observable objects\n    if (destIsVueObservable || sourceIsVueObservable) {\n      const isObject = _isObject(source[key])\n      const isFeathersVuexInstance =\n        isObject &&\n        !!(\n          source[key].constructor.modelName || source[key].constructor.namespace\n        )\n      // Do not use fastCopy directly on a feathers-vuex BaseModel instance to keep from breaking reactivity.\n      if (isObject && !isFeathersVuexInstance) {\n        try {\n          const sourceObject = source[key]\n          dest[key] = fastCopy(source[key])\n        } catch (err) {\n          if (!err.message.includes('getter')) {\n            throw err\n          }\n        }\n      } else {\n        try {\n          dest[key] = source[key]\n        } catch (err) {\n          if (!err.message.includes('getter')) {\n            throw err\n          }\n        }\n      }\n      return\n    }\n    // Handle defining accessors\n    if (\n      typeof sourceDesc.get === 'function' ||\n      typeof sourceDesc.set === 'function'\n    ) {\n      Object.defineProperty(dest, key, sourceDesc)\n      return\n    }\n    // Do not attempt to overwrite a getter in the dest object\n    if (destDesc && typeof destDesc.get === 'function') {\n      return\n    }\n    // Assign values\n    // Do not allow sharing of deeply-nested objects between instances\n    // Potentially breaks accessors on nested data. Needs recursion if this is an issue\n    if (_isObject(sourceDesc.value) && !isBaseModelInstance(sourceDesc.value)) {\n      var value = fastCopy(sourceDesc.value)\n    }\n    dest[key] = value || sourceDesc.value\n  })\n  return dest\n}\nexport function checkNamespace(namespace, item, debug) {\n  if (!namespace && debug) {\n    // eslint-disable-next-line no-console\n    console.error(\n      'A `namespace` was not available on the Model for this item:',\n      item,\n      'this can be caused by not passing the Model into the makeServicePlugin function'\n    )\n  }\n  return namespace !== null && namespace !== undefined\n}\nexport function assignIfNotPresent(Model, props) {\n  for (let key in props) {\n    if (!Model.hasOwnProperty(key)) {\n      Model[key] = props[key]\n    }\n  }\n}\n"]}]}